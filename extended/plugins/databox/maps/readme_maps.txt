 --------------------------------------------------------------------------------
 DataBox プラグイン MAPS Option FOR DataBox 0.0.0.20140917以上

 tsuchitani AT ivywe DOT co DOT jp
 last update 2015/01/08
 --------------------------------------------------------------------------------
 概略機能 ：
 　1.DataBox のデータでmapsプラグインのマーカーを更新する
     （マスターに登録したIDのマーカー削除後追加作成）
 　2.「MAPS markers 更新」 のスケジュール実行(疑似CRON)
 --------------------------------------------------------------------------------
 使用手順
 　1.MAPS markers 更新を実行する
 --------------------------------------------------------------------------------
 maps機能追加方法
 　1.データベースおよびファイルのバックアップをとります
 　2.maps用プログラムおよびフォルダをアップします
 　3.logs/databox_mapsupdate.log maps markers 更新時のログ を作成します
 --------------------------------------------------------------------------------
 MAPS機能削除方法
 　1.maps用ファイルを削除します
 --------------------------------------------------------------------------------
 コンフィギュレーション
   マップIDを登録するマスターの種別(maps_mid) default:mapid
   都道府県を登録するアトリビュートのテーマ変数(maps_pref) default:pref
   住所１を登録するアトリビュートのテーマ変数(maps_address1) default:address1
   緯度を登録するアトリビュートのテーマ変数(maps_lat) default:lat
   経度を登録するアトリビュートのテーマ変数(maps_lng) default:lng
   住所２を登録するアトリビュートのテーマ変数(maps_address2) default:address2
   住所３を登録するアトリビュートのテーマ変数(maps_address3) default:address3
   Cronのスケジュール間隔(maps_cron_schedule_interval) default:0
 --------------------------------------------------------------------------------
 MAPS 用 file

 -databox
   ├ admin
   │ └ maps.php 
   │
   ├ maps
   │ ├ history
   │ ├ maps_markersupdate.inc
   │ ├ maps_scheduled.inc
   │ ├ masps.inc
   │ └ readme_maps.txt

 GEEKLOG
   ├ logs
   │ ├ databox_mapsupdate.log

 （抽出条件）
 公開日＜＝現在＜公開終了日
 下書　オフ
 マップIDが登録されている
 都道府県が登録されている
 住所１が登録されている
 
 緯度経度が登録されていない、あるいは住所から計算(mappsプラグインの関数使用)できない場合は、
 処理対象外です。
 １日に計算できる件数には制限があります。
 参考https://developers.google.com/maps/documentation/geocoding/?hl=ja
 

 （編集）
 マーカー名：
 緯度：アトリビュート 「緯度のテーマ変数」
 経度：アトリビュート 「経度のテーマ変数」
 マップID：アトリビュート テーマ変数=「マップIDを登録するマスターの種別」のマスターのvalue2
 マーカーアイコンID：アトリビュート テーマ変数=「マップIDを登録するマスターの種別」のマスターのdisp
 住所：アトリビュート 「都道府県のテーマ変数」のデータ
      +" " +アトリビュート 「住所１のテーマ変数」のデータ
      +" " +アトリビュート 「住所２のテーマ変数」のデータ
      +" " +アトリビュート 「住所３のテーマ変数」のデータ
 詳細：基本 説明
 Ressource ＃10：コード
 mkid：自動採番　YmdHis連番 
       注：連番は、出力処理件数が10000未満の場合は４桁です
           maps プラグインではYmdHis３桁の乱数

 (DataBox データの緯度経度の更新)
  DataBox データの緯度経度の項目があって空欄の場合は、住所から計算された内容で更新
  します
 --------------------------------------------------------------------------------
 MAPSのマーカーとDataBoxのデータ の連携方法
 --------------------------------------------------------------------------------
 (A)MAPSで、DataBoxのデータと連携するマーカーを登録する場合
    MapsのマーカーのRessource ＃10　に　連携するDataBoxのデータのコードを登録します

 (B)DataBoxの「MAPS markers 更新」で、データと連携するマーカーを登録する場合
    事前準備
      ①DataBoxのマスターを登録します
       「マップIDを登録するマスターの種別」でマスターを登録します
        VALUE2 に、マップIDを登録します
        VALUE2 に0を登録するとマーカーを作成しません
        VALUE2 にMapsプラグインに登録されていないマップIDを登録すると、
        「MAPS markers 更新」時にエラーになります
      ②MAPID用アトリビュートを登録します
        タイプをオプションリスト（マスター）またはラジオボタン（マスター）指定
        テーマ変数とマスターの種別「マップIDを登録するマスターの種別」とし、登録します
      ③都道府県用アトリビュートを登録します
      ④住所１用アトリビュートを登録します
      ⑤緯度用アトリビュートを登録します（任意）
      ⑥経度用アトリビュートを登録します（任意）
      ⑦住所２を登録します（任意）
      ⑧住所３を登録します（任意）
      ⑨登録したアトリビュートを含むデーターを登録します

   「MAPS markers 更新」を実行する
     「MAPS markers 更新」は ①で登録したマップのマーカーをすべて削除した後、
      連携するDataの内容でマーカーを追加作成します。
 --------------------------------------------------------------------------------
 メッセージ
 --------------------------------------------------------------------------------
 ---->DataBox MapsUpdate scheduled processing Start
 ---->DataBox MapsUpdate CRON processing Start
 ---->DataBox MapsUpdate URL processing Start
 Maps marker Mapid(9999) INVALID id=9999
 Maps marker Can not be calculated latitude and longitude id=9999;
 Maps marker Insert id: 9999 code:xxxx;
 <----DataBox MapsUpdate scheduled processing End
 <----DataBox MapsUpdate CRON processing End
 <----DataBox MapsUpdate URL processing End
処理終了しました正常 9999 件 エラー 9999 件 (緯度・経度 計算 9999 件 更新 9999 件)
     注:１日に計算できる件数には制限があります。
	   （）内は、計算した件数とそれを更新した件数です。
