 --------------------------------------------------------------------------------
 DataBox プラグイン CSV Option FOR DataBox  0.0.0.20141007b以上
                                   Geeklog 2.1.0以上
 tsuchitani AT ivywe DOT co DOT jp
 last update 2014/10/28
 --------------------------------------------------------------------------------
 概略機能 ：
 　1.CSVファイルからのインポート(既存データ更新と新規データ追加)
 　　あらかじめ条件を登録することにより、CSVファイルの部分的インポートが可能
 　2.CSVファイルへのエクスポート
 　3.スケジュール実行(疑似CRON)
 　 3-1.「（コンフィギュレーション設定のスケジュール:条件）インポート」
 　 3-2.入力ファイル削除         （省略可）
 　 3-3.「MAPS markers 更新」    （省略可）
 　 3-4.キャッシュ一括削除

 --------------------------------------------------------------------------------
 使用手順
 　準備 
 　　1.CSV定義を登録する
 　　2.条件を登録する（省略可）

 　・インポート用ファイルを用意しインポートを実行する
 　・エクスポートを実行する
 --------------------------------------------------------------------------------
 CSV機能追加方法
 　1.データベースおよびファイルのバックアップをとります
 　2.CSV 用プログラムフォルダをアップします
 　　plugins/databox/csv
 　3.管理者としてログインし，DataBoxプログラムのCSVタブの初期化を実行する
 
 必要なフォルダ＆ファイル
 　　public_html/databox_csv (CSV一括インポートディレクトリ)
 　　private/data/databox_csv/ (CSVエキスポートディレクトリ)
 　　　上記は、コンフィギュレーション設定で変更可能です
 作成されるファイル
 　　logs/databox_csvimport.log CSVインポート時のログ
 --------------------------------------------------------------------------------
 CSV機能削除方法
 　1.データベースおよびファイルのバックアップをとります。
 　2.CSV 用プログラムフォルダを削除します
 　　データベース上のCSV用データは、削除されません
 --------------------------------------------------------------------------------
 コンフィギュレーション
   CSV一括インポートディレクトリ(path_csv) default:$_CONF['path_html']."databox_csv"
   CSVエキスポートディレクトリ(path_csv_out) default:$_CONF['path']."data/databox_csv"
   CSV一括インポートデフォルトタイプ(csv_default_fieldset_id)default:
   CSV一括インポートデフォルト所有者ID(csv_default_owner_id)default:2
   Cronのスケジュール間隔(csv_cron_schedule_interval) default:0
   スケジュール.終了後入力ファイル削除(csv_csv_cron_schedule_unlink) default:いいえ(0)
   スケジュール.続けてMaps実行(csv_cron_schedule_nextmaps) default:いいえ(0)
   スケジュール.条件(csv_cron_schedule_sel_id) default:条件なし(0)
 --------------------------------------------------------------------------------
 CSV 用 file

 -databox
   ├ admin
   │ └ csv.php 
   │
   ├ csv
   │ ├ sql
   │ │ └ mysql_install_csv.php
   │ │ 
   │ ├ csv.inc
   │ ├ csv_functions.php
   │ ├ csv.importexec.php
   │ ├ csv_scheduled.php
   │ ├ history
   │ └ readme_csv.txt
   │
   ├ templates
   │ ├ admin
   │ │ ├ csvimportform.thtml
   │ │ ├ csvseldtl_editor.thtml
   │ │ ├ csvsel_editor.thtml
   │ │ └ csv_editor.thtml
    │


 GEEKLOG
   ├ data
   │ ├ databox_csv  (CSVエキスポートディレクトリ)
   │
   ├ logs
   │ ├ databox_csvimport.log
   │
   ├ public_html
   │ │
   │ ├ databox_csv  (CSV一括インポートディレクトリ)
   │ │

 --------------------------------------------------------------------------------
【CSVインポートファイルの仕様】
    フォーマット：CSV
	カラムの区切り記号：,
    エンコード：はUTF-8
    カラム囲み記号:"
    １行目は、２行目以降のデータの内容を表すタイトル行

 --------------------------------------------------------------------------------
【CSV定義】
    一部の基本項目と特定のタイプのアトリビュート、カテゴリが登録できます

インポート設定できる基本項目
    コード、タイトル、タイプID、公開日、公開終了日
    ID(更新の場合のみ有効)
    ドラフト、ページタイトル、説明、テンプレートディレクトリ
    所有者ID
インポート設定できるアトリビュートのタイプ
    00 一行テキスト
    10 複数行テキスト
    01 HTML（複数行テキスト）
    20 TinyMCEモード（複数行テキスト）
    07 オプションリスト（選択肢）
    08 ラジオボタン（選択肢）
    12 画像（ファイル保存）
    09 オプションリスト（マスター）
    16 ラジオボタン（マスター）
    15 数値
    21 通貨

    マスターを使用するアトリビュートタイプは、フィールドを２種類用意します
    どちらか一方で登録してください
        1.No. で引き当てる場合（アトリビュート項目名）
        2.value で引き当てる場合（アトリビュート項目名_value）
カテゴリ
    VALUE にカテゴリの名称を登録します

注1　データタイプについて
    1.タイプなしで運用するサイトの場合
    　タイプIDのXML定義は登録する必要がありません
    2.複数のタイプを登録運用するサイトでXML入力データでタイプを指定しない場合
    　コンフィギュレーション設定のCSV一括インポートデフォルトタイプをタイプIDとして登録します
    
 --------------------------------------------------------------------------------
【条件】
インポート用CSVファイルの１行目が登録した条件にあう行のみインポートします。
論理積（AND）のみ対応
比較する値は、,区切りで複数指定できます。

例　駐車場,賃貸アパート 

パターンA
(CSV１行目=value)
ドラフト=0
店舗ID＝83942900
物件タイプ ＝ 駐車場,アパート

注１　条件明細のCSV１行目がない場合は、その条件は無視されます
注２　物件タイプ ＝ 駐車場
　　　物件タイプ ＝ アパート
　　　と登録すると　物件タイプ ＝ 駐車場　AND 物件タイプ ＝ アパート　になり
　　　条件にあわなくなります
 --------------------------------------------------------------------------------
【公開日および公開終了日　の入力ファイルの書式】

 1.日付を表す書式であればOK
   例1：20140521
   例2：20140521150000
   例3：2014/05/21
   例4：2014-05-21

 2.時刻が入力されていない場合
   公開日は00:00
   公開終了日は23:59

   公開日の例
     20140521　→ 2014/05/21 00:00:00
     20140521150000　→ 2014/05/21 15:00:00

   公開終了日の例
     20140521　→ 2014/05/21 23:59:00
     20140521150000　→ 2014/05/21 15:00:00

 --------------------------------------------------------------------------------
【同一コードのデータがある場合ない場合の処理】
  同一コードのデータがすでにある場合
    入力ファイルにない項目は、従来の内容を変更しません
    入力ファイルにタイプが指定されていも、それは無視します
  同一コードのデータがすでにある場合
    新規追加になります
    まるごと入替たい時は、事前に削除してください
	